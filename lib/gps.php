<?php

function get_data()
{
    $curl = curl_init();
    curl_setopt_array($curl, array(
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_ENCODING => "",
        CURLOPT_MAXREDIRS => 10,
        CURLOPT_TIMEOUT => 30,
        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
        CURLOPT_URL => "https://socketgpsv1.gestsol.cl/api/lpf",
        CURLOPT_CUSTOMREQUEST => "GET",
        CURLOPT_HTTPHEADER => array(
            "content-type: application/json"
        ),
        CURLOPT_SSL_VERIFYHOST => false,
        CURLOPT_SSL_VERIFYPEER => false
    ));

    $response = json_decode(curl_exec($curl));
    print_r(json_encode($response));
    $err = curl_error($curl);

    curl_close($curl);
    return $response;
}


function get_data_flota($filter)
{
    $curl = curl_init();
    curl_setopt_array($curl, array(
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_ENCODING => "",
        CURLOPT_MAXREDIRS => 10,
        CURLOPT_TIMEOUT => 30,
        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
        CURLOPT_URL => "https://socketgpsv1.gestsol.cl/api/lpf?company_id=$filter",
        CURLOPT_CUSTOMREQUEST => "GET",
        CURLOPT_HTTPHEADER => array(
            "content-type: application/json"
        ),
        CURLOPT_SSL_VERIFYHOST => false,
        CURLOPT_SSL_VERIFYPEER => false
    ));

    $response = json_decode(curl_exec($curl));
    $err = curl_error($curl);

    curl_close($curl);
    return $response;
}

function get_position($name)
{
    $devices = get_data();
    $found = [];
    foreach ($devices as $device) {
        if (strpos(strtolower($device->name), strtolower($name)) !== false) {
            array_push($found,"*Movil:* ". $device->name . "\\n*Patente:* ".$device->plate."\\n*Velocidad*: ".$device->speed."\\n*Fecha:* ".$device->gps_date."\\n*URL:* https://www.google.com/maps/?q=" . $device->lat . "," . $device->lng);
        }
        if (strpos(str_replace('-', '', strtolower($device->plate)), str_replace('-', '', strtolower($name))) !== false) {
            array_push($found,"*Movil:* ". $device->name . "\\n*Patente:* ".$device->plate."\\n*Velocidad*: ".$device->speed."\\n*Fecha:* ".$device->gps_date."\\n*URL:* https://www.google.com/maps/?q=" . $device->lat . "," . $device->lng);
        }
    }
    return $found;
}

function get_geofence($filter)
{
    $geofences = '[{"alert":false,"company_id":11,"geofence_type_id":1,"geom":{"ne":{"lat":-33.27809040545184,"lng":-70.99366097711027},"sw":{"lat":-33.34580171945057,"lng":-71.12412362359464}},"id":62,"name":"test contoles"},{"alert":true,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.214709049605275,"lng":-70.77231645651045},"radius":22.232210747820645},"id":251,"name":"LLEGADA"},{"alert":false,"company_id":11,"geofence_type_id":1,"geom":{"ne":{"lat":-33.379855141224546,"lng":-70.4995716000418},"sw":{"lat":-33.57458472547573,"lng":-70.78796271332305}},"id":39,"name":"prueba victor"},{"alert":false,"company_id":11,"geofence_type_id":1,"geom":{"ne":{"lat":-33.379855141224546,"lng":-70.4995716000418},"sw":{"lat":-33.57458472547573,"lng":-70.78796271332305}},"id":40,"name":"prueba victor"},{"alert":false,"company_id":11,"geofence_type_id":3,"geom":{"ne":{"lat":-33.325149605276536,"lng":-70.93048959039152},"sw":{"lat":-33.3595670750184,"lng":-71.00052743218839}},"id":59,"name":"test controles"},{"alert":false,"company_id":11,"geofence_type_id":1,"geom":{"ne":{"lat":-33.27809040545184,"lng":-70.99366097711027},"sw":{"lat":-33.34580171945057,"lng":-71.12412362359464}},"id":60,"name":"test contoles"},{"alert":false,"company_id":11,"geofence_type_id":1,"geom":{"ne":{"lat":-33.27809040545184,"lng":-70.99366097711027},"sw":{"lat":-33.34580171945057,"lng":-71.12412362359464}},"id":61,"name":"test contoles"},{"alert":false,"company_id":11,"geofence_type_id":1,"geom":{"ne":{"lat":-33.27809040545184,"lng":-70.99366097711027},"sw":{"lat":-33.34580171945057,"lng":-71.12412362359464}},"id":63,"name":"test contoles"},{"alert":false,"company_id":11,"geofence_type_id":1,"geom":{"center":{"lat":-33.42987262204299,"lng":-70.91263680718839},"radius":5508.685543377452},"id":64,"name":"carlos"},{"alert":false,"company_id":11,"geofence_type_id":1,"geom":{"center":{"lat":-33.42987262204299,"lng":-70.91263680718839},"radius":5508.685543377452},"id":66,"name":"carlos"},{"alert":false,"company_id":11,"geofence_type_id":1,"geom":{"center":{"lat":-33.434456880049524,"lng":-70.89890389703214},"radius":4388.987419084745},"id":67,"name":"carlos"},{"alert":false,"company_id":11,"geofence_type_id":1,"geom":{"center":{"lat":-33.43904089589992,"lng":-70.88654427789152},"radius":2341.611884532367},"id":68,"name":"carlos 2"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.09076722714941,"lng":-70.39513795241983},"radius":285.9498512039449},"id":50,"name":"La Junta (I) "},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.08076735726992,"lng":-70.37658756404001},"radius":1493.828169325871},"id":47,"name":"Sewell (F) "},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.0862132706336,"lng":-70.44978405584527},"radius":1273.8982308016316},"id":43,"name":"Colon (A) "},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.159714174395,"lng":-70.741270618584},"radius":4700},"id":53,"name":"Rancagua (E) "},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.099047823325094,"lng":-70.43157365990686},"radius":302.8559927347945},"id":44,"name":"Entrada tunel "},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.088349520003014,"lng":-70.38783633586928},"radius":202.86717693244924},"id":45,"name":"Adit 71 "},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.09710117897006,"lng":-70.4247944404691},"radius":298.9028676007093},"id":46,"name":"Salida tunel "},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.08159687113145,"lng":-70.35866036830794},"radius":489.491427024207},"id":48,"name":"Adit 42 (G) "},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.1062339695879,"lng":-70.36899013409402},"radius":364.2689075508159},"id":49,"name":"Joachim (K) "},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.21406788434404,"lng":-70.77324636942342},"radius":278.889920507561},"id":55,"name":"Tandem "},{"alert":true,"company_id":39,"geofence_type_id":8,"geom":{"center":{"lat":-23.834229306876782,"lng":-70.31351251784514},"radius":864.8580279464752},"id":73,"name":"CRUZE PAPOZO"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.19411425791204,"lng":-70.56383956972945},"radius":129.11418816347347},"id":54,"name":"Maitenes (H) "},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.1936087525836,"lng":-70.6486163054114},"radius":42.1997973745149},"id":52,"name":"Guindal "},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.20500640534641,"lng":-70.53016069347854},"radius":1355.5890255544143},"id":56,"name":"Coya (D) "},{"alert":true,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.09749803557803,"lng":-70.52019689928},"radius":130.88441583164095},"id":57,"name":"Barahona (C) "},{"alert":true,"company_id":39,"geofence_type_id":8,"geom":{"center":{"lat":-22.47065830279049,"lng":-68.8980450312703},"radius":824.4957164371701},"id":77,"name":"CRUCE LINEA TREN DE CALAMA"},{"alert":true,"company_id":39,"geofence_type_id":8,"geom":{"center":{"lat":-27.401135105287988,"lng":-70.3452521496315},"radius":1497.704236014973},"id":71,"name":"INGRESO A COPIAPO"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-18.464123649214603,"lng":-70.29982080383684},"radius":49.12576109448999},"id":76,"name":"Bencinera Arica"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-26.25214231044399,"lng":-69.62618561059935},"radius":79.60581568277313},"id":83,"name":"Bencinera El Salvador"},{"alert":false,"company_id":39,"geofence_type_id":6,"geom":{"ne":{"lat":-33.45810505395573,"lng":-70.64944966889936},"sw":{"lat":-33.45863315850461,"lng":-70.65033211566526}},"id":97,"name":"Agencia San Diego"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"ne":{"lat":-33.025669382386376,"lng":-71.54627136039994},"sw":{"lat":-33.027346997372085,"lng":-71.547902143481}},"id":108,"name":"Bencinera Lago Peñuelas"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-41.45691499883233,"lng":-72.96059224085565},"radius":76.79564644992337},"id":111,"name":"Bencinera Puerto Montt"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-36.81811972734832,"lng":-72.98864411572345},"radius":85.78630404758165},"id":79,"name":"Bencinera Concepcion Storage COPEC"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-27.370034011878396,"lng":-70.3338811258173},"radius":29.87823102209129},"id":80,"name":"Bencinera Copiapo"},{"alert":false,"company_id":39,"geofence_type_id":6,"geom":{"ne":{"lat":-33.454659805259595,"lng":-70.67754676930485},"sw":{"lat":-33.45513646107291,"lng":-70.67800274483739}},"id":82,"name":"Agencia Exposición"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-22.926367461649225,"lng":-69.10170603551023},"radius":39.73944223984786},"id":85,"name":"Bencinera Faena Centinela Oxidos Tesoro"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-23.00812324025208,"lng":-69.09902599925977},"radius":42.846141531613924},"id":86,"name":"Bencinera Faena Centinela Sulfuros Esper"},{"alert":false,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-33.487711885856214,"lng":-70.5499822147263},"radius":77.6938750193699},"id":89,"name":"Agencia La Reina"},{"alert":false,"company_id":39,"geofence_type_id":6,"geom":{"ne":{"lat":-33.44709893491411,"lng":-70.65710179766222},"sw":{"lat":-33.44724216820226,"lng":-70.6572600479941}},"id":98,"name":"Agencia San Ignacio"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-37.441033400702544,"lng":-72.32860613604629},"radius":83.53394550879752},"id":109,"name":"Bencinera Los Angeles"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-38.71039716414641,"lng":-72.55658003238631},"radius":90.68735979019621},"id":112,"name":"Bencinera Temuco"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"ne":{"lat":-33.04557574307142,"lng":-71.61547595864016},"sw":{"lat":-33.04604339385194,"lng":-71.6159158409186}},"id":115,"name":"Bencinera Valparaiso Storage Petrobras"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-31.817421975061407,"lng":-70.57671929446798},"radius":59.11503047990299},"id":88,"name":"Bencinera Faena Los Pelambres"},{"alert":true,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.214709049605275,"lng":-70.77231645651045},"radius":22.232210747820645},"id":252,"name":"LLEGADA"},{"alert":false,"company_id":39,"geofence_type_id":6,"geom":{"ne":{"lat":-33.54016067564418,"lng":-70.57396338859883},"sw":{"lat":-33.540390943975694,"lng":-70.57440327087727}},"id":91,"name":"Agencia La Florida"},{"alert":false,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-33.383730145250105,"lng":-70.76244897885636},"radius":130.9596350857109},"id":92,"name":"Agencia Lo Boza"},{"alert":false,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-33.45668411506118,"lng":-70.63739610668341},"radius":31.295226307023004},"id":93,"name":"Agencia Matta"},{"alert":false,"company_id":39,"geofence_type_id":6,"geom":{"ne":{"lat":-33.47112734091802,"lng":-70.61010307839257},"sw":{"lat":-33.47140030350747,"lng":-70.61047322323662}},"id":94,"name":"Agencia Ñuñoa"},{"alert":false,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-33.42592350038958,"lng":-70.64314296618903},"radius":11.024810150317098},"id":95,"name":"Agencia Patronato"},{"alert":false,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-33.590323456465725,"lng":-70.70323680967704},"radius":14.398682566251805},"id":96,"name":"Agencia San Bernardo"},{"alert":false,"company_id":39,"geofence_type_id":6,"geom":{"ne":{"lat":-33.45340471955454,"lng":-70.64761770788175},"sw":{"lat":-33.45380081973893,"lng":-70.64812196317655}},"id":100,"name":"Agencia Serrano"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"ne":{"lat":-33.45439065276627,"lng":-70.68062413596067},"sw":{"lat":-33.455500611235294,"lng":-70.68107206486616}},"id":101,"name":"Agencia Borja"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-33.44687874732824,"lng":-70.67865564722024},"radius":47.23917950760239},"id":69,"name":"Agencia Chacabuco"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-33.40301469291085,"lng":-70.65749406666004},"radius":16.748555609086846},"id":11,"name":"Agencia Einstein"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-33.454439321735016,"lng":-70.68536197736285},"radius":17.35206270511029},"id":99,"name":"Agencia Thomson"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-32.75355529127889,"lng":-70.71936955724487},"sw":{"lat":-32.755132048235645,"lng":-70.72151264224777}},"id":163,"name":"LX"},{"alert":true,"company_id":39,"geofence_type_id":8,"geom":{"center":{"lat":-26.339971405010235,"lng":-70.62100254232968},"radius":72.32834135115587},"id":78,"name":"Bencinera Chañaral"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.17851787582021,"lng":-70.65322287274381},"radius":1149.2858210361717},"id":103,"name":"Machali"},{"alert":true,"company_id":39,"geofence_type_id":8,"geom":{"center":{"lat":-33.508565621007406,"lng":-70.71447446669592},"radius":191.21530883900908},"id":75,"name":"ENTRADA A BASE"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-20.213920470914488,"lng":-70.13193835874193},"radius":65.65244722061554},"id":104,"name":"Bencinera Iquique"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"ne":{"lat":-33.457059934775316,"lng":-70.68544669011493},"sw":{"lat":-33.45775616103237,"lng":-70.68642837861438}},"id":105,"name":"Bencinera Jotabeche"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-29.908168543907284,"lng":-71.25644759679278},"radius":79.06500947370859},"id":106,"name":"Bencinera La Serena Storage Petrobras"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-39.27720923650443,"lng":-71.97205639169982},"radius":55.40946021268376},"id":110,"name":"Bencinera Pucon Storage Enex"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-39.850609397352095,"lng":-73.19550119771174},"radius":56.49949143633954},"id":113,"name":"Bencinera Valdivia"},{"alert":false,"company_id":39,"geofence_type_id":1,"geom":{"center":{"lat":-32.73204049192144,"lng":-71.45186297754151},"radius":51.65308210578468},"id":116,"name":"Bencinera Ventanas"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-33.45239633886512,"lng":-70.55596742609288},"radius":59.57467112435279},"id":90,"name":"Agencia Larrain "},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-33.44379025059745,"lng":-70.6503943924443},"radius":52.70194822865614},"id":117,"name":"Agencia Metro U de Chile"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-33.479986035240685,"lng":-70.69203233074984},"radius":20.00446512987424},"id":72,"name":"Agencia Cerrillos"},{"alert":true,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.214709049605275,"lng":-70.77231645651045},"radius":22.232210747820645},"id":253,"name":"LLEGADA"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.19580519268953,"lng":-70.6732556251763},"radius":435.1061660544979},"id":130,"name":"Nogales"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.166470631239925,"lng":-70.76386986858665},"radius":55.585399461607295},"id":121,"name":"BAQUEDANO"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.183184626000106,"lng":-70.72555958854457},"radius":85.7532410241871},"id":122,"name":"MANZANAL ESPECIAL"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.13266501361348,"lng":-70.73794123217908},"radius":73.44573103042079},"id":123,"name":"SOL - DON MATEO"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.14752766113015,"lng":-70.72998232673064},"radius":88.86066986695761},"id":125,"name":"NORTE MEMBRILLAR"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.13071400506799,"lng":-70.75110901480099},"radius":286.26242903928056},"id":126,"name":"NELSON PEREIRA"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.171154724755425,"lng":-70.77712617401346},"radius":396.0816888442575},"id":120,"name":"ORO NEGRO-SAN PEDRO"},{"alert":false,"company_id":34,"geofence_type_id":2,"geom":{"center":{"lat":-34.1997563475465,"lng":-70.75981504592744},"radius":96.76098075529627},"id":132,"name":"GULTRO"},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-20.43062221023012,"lng":-70.1588592390608},"radius":664.7459460009816},"id":134,"name":"Iquique (Caleta pesquera los verdes)"},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-26.282408987555996,"lng":-69.58859899298034},"radius":2167.3005813177506},"id":139,"name":"Salvador (Llanta)"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.17883741043092,"lng":-70.71286756298753},"radius":100.73861887440232},"id":124,"name":"ALAMEDA - MACHALI - LA VINILLA"},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-32.61240099999804,"lng":-71.23439464063932},"radius":176.41990579724938},"id":144,"name":"Nogales"},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-30.712926204825397,"lng":-71.49130945612069},"radius":397.70427270844834},"id":143,"name":"Ovalle (Socos)"},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-29.831607011692412,"lng":-71.26441619977265},"radius":528.9178880723811},"id":142,"name":"Serena Norte (Punta Teatinos)"},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-29.974656504047744,"lng":-71.34242530063386},"radius":467.10889305354226},"id":141,"name":"caleta los Hornos"},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-22.073513371396054,"lng":-70.19231232700201},"radius":285.3033841244047},"id":136,"name":"Tocopilla "},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-20.24806730219579,"lng":-69.78384331951372},"radius":1283.492065568768},"id":135,"name":"Iquique (Pozo Almonte)"},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-18.84178836162913,"lng":-70.13146665324143},"radius":3204.2287124354984},"id":133,"name":"Arica (Chaca)"},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-26.305469486719144,"lng":-70.453181630546},"radius":2131.9914524682545},"id":138,"name":"Chañaral (Portezuelo Blanco)"},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-27.414067701043965,"lng":-70.27271149725544},"radius":990.8711621927519},"id":140,"name":"Copiapo (Paipote)"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.1666576181813,"lng":-70.7233315924775},"radius":128.0235594777177},"id":127,"name":"Zenith 1"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"ne":{"lat":-34.20080156228091,"lng":-70.68823536179804},"sw":{"lat":-34.20090804454394,"lng":-70.68823536179804}},"id":129,"name":"Nogales"},{"alert":false,"company_id":34,"geofence_type_id":4,"geom":{"center":{"lat":-34.19387299055685,"lng":-70.75528495914216},"radius":236.49440947238142},"id":119,"name":"puente cachapoal"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.04597414026503,"lng":-71.604812250561},"sw":{"lat":-33.04761089972915,"lng":-71.60754810375619}},"id":147,"name":"KA"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.407723733243834,"lng":-71.69251215736244},"sw":{"lat":-33.40825662251172,"lng":-71.69304055253838}},"id":164,"name":"KM"},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-33.955631151358354,"lng":-70.71373745713146},"radius":364.6515058268131},"id":145,"name":"San Francisco de Mostazal"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-28.575149,"lng":-70.763182},"radius":100.0},"id":182,"name":"Vallenar"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-29.969231,"lng":-71.265563},"radius":100.0},"id":184,"name":"La serena"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.0237353609442,"lng":-71.54523622659042},"sw":{"lat":-33.02600220726947,"lng":-71.54939901498153}},"id":148,"name":"KB"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-31.631179,"lng":-71.166532},"radius":100.0},"id":186,"name":"Illapel"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-31.911294,"lng":-71.503152},"radius":100.0},"id":188,"name":"Los vilos"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-32.743793,"lng":-70.717486},"radius":100.0},"id":190,"name":"San felipe"},{"alert":false,"company_id":29,"geofence_type_id":8,"geom":{"center":{"lat":-33.433102341952534,"lng":-71.19431029219817},"radius":1027.9646891835255},"id":149,"name":"RO"},{"alert":true,"company_id":29,"geofence_type_id":7,"geom":{"ne":{"lat":-33.454675507781914,"lng":-70.6856451885522},"sw":{"lat":-33.454979324645294,"lng":-70.6860421554864}},"id":158,"name":"APARCADERO"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-32.827208,"lng":-70.600416},"radius":100.0},"id":192,"name":"Los Andes"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.591630614572324,"lng":-71.61391847624526},"sw":{"lat":-33.59258241501043,"lng":-71.61460780396209}},"id":156,"name":"KQ"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.539496878001266,"lng":-71.5952996860965},"sw":{"lat":-33.540017779390425,"lng":-71.59595414509613}},"id":160,"name":"KK"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.047670733692584,"lng":-71.43158677006699},"sw":{"lat":-33.04845088115809,"lng":-71.43193813944794}},"id":165,"name":"KD"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-18.463962938523906,"lng":-70.29956181738487},"radius":63.09969861897721},"id":173,"name":"Agencia Arica"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-20.213895723568935,"lng":-70.13186839786044},"radius":60.47948238484146},"id":174,"name":"Agencia Iquique (Sotomayor)"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-23.60884766025424,"lng":-70.38932655789682},"radius":63.88328484791799},"id":176,"name":"Agencia Antofagasta"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-26.24677115215172,"lng":-69.62848264741444},"radius":49.969228385117965},"id":178,"name":"Agencia El Salvador"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-26.346661331244253,"lng":-70.62106613236983},"radius":59.45156132193764},"id":180,"name":"Agencia Chañaral"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.046625,"lng":-71.605131},"radius":100.0},"id":194,"name":"Valparaiso"},{"alert":true,"company_id":34,"geofence_type_id":2,"geom":{"center":{"lat":-34.207506262965275,"lng":-70.76397640872858},"radius":115.10774680448255},"id":131,"name":"COPEC GULTRO"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.45683430277152,"lng":-70.71487249400424},"sw":{"lat":-33.45845618904673,"lng":-70.71869732405948}},"id":168,"name":"TP"},{"alert":false,"company_id":8,"geofence_type_id":1,"geom":{"center":{"lat":-33.43126255127005,"lng":-70.81791411971847},"radius":494.15291132120797},"id":250,"name":"Prueba Modificado"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.45362560001816,"lng":-71.66811473628877},"sw":{"lat":-33.454829556875524,"lng":-71.66955508252977}},"id":161,"name":"KL"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-32.98630065432791,"lng":-71.27162155757958},"sw":{"lat":-32.98834348448114,"lng":-71.27381024013573}},"id":171,"name":"KF"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.45297901379304,"lng":-70.68541366202209},"sw":{"lat":-33.45442891667393,"lng":-70.68643156034324}},"id":157,"name":"MB"},{"alert":true,"company_id":47,"geofence_type_id":8,"geom":{"center":{"lat":-22.878450351981527,"lng":-69.31249200655077},"radius":15437.879360355957},"id":137,"name":"Calama (Sierra Gorda)"},{"alert":false,"company_id":34,"geofence_type_id":1,"geom":{"ne":{"lat":-32.91291791775572,"lng":-70.62466518672989},"sw":{"lat":-32.913782569189024,"lng":-70.6253518322377}},"id":128,"name":"Prueba"},{"alert":true,"company_id":8,"geofence_type_id":1,"geom":{"center":{"lat":-33.307701384679206,"lng":-71.0975909418745},"radius":8777.323517445873},"id":257,"name":"Prueba Geo"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-29.956128,"lng":-71.337631},"radius":100.0},"id":183,"name":"Coquimbo"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-30.598731,"lng":-71.198775},"radius":100.0},"id":185,"name":"Ovalle"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-31.780343,"lng":-70.963991},"radius":100.0},"id":187,"name":"Salamanca"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-32.450733,"lng":-71.230632},"radius":100.0},"id":189,"name":"La ligua"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.36982226472803,"lng":-71.66601690790094},"sw":{"lat":-33.370973624217555,"lng":-71.66823241254724}},"id":159,"name":"KN"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-32.787463,"lng":-71.19242},"radius":100.0},"id":191,"name":"La calera"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.45316660581796,"lng":-70.67925782937402},"sw":{"lat":-33.456236902798224,"lng":-70.68030389088983}},"id":169,"name":"MA"},{"alert":true,"company_id":41,"geofence_type_id":8,"geom":{"center":{"lat":-23.54698990012876,"lng":-70.39143205779038},"radius":253.2516209772105},"id":260,"name":"Tandem Antofa"},{"alert":true,"company_id":24,"geofence_type_id":8,"geom":{"center":{"lat":-26.348635216481632,"lng":-70.62807466031666},"radius":257.44132519841156},"id":265,"name":"CHAÑARAL"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-32.99522333501608,"lng":-71.18124447484979},"sw":{"lat":-32.995922961430864,"lng":-71.182003540001}},"id":167,"name":"KG"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.45422207566437,"lng":-70.68743749960538},"sw":{"lat":-33.45474742773323,"lng":-70.68868204458829}},"id":146,"name":"MD"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-20.21610653278129,"lng":-70.14747307427717},"radius":21.668009064253113},"id":175,"name":"Agencia iquique (Barros)"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-22.437718780841227,"lng":-68.91676086947263},"radius":98.97971680111914},"id":177,"name":"Agencia Calama"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-26.39189364564252,"lng":-70.04750814827901},"radius":119.60219882978237},"id":179,"name":"Agencia Diego almagro"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-32.961053,"lng":-71.50879},"radius":100.0},"id":193,"name":"Viña del mar"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.329183,"lng":-70.701984},"radius":100.0},"id":195,"name":"San Ignacio"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.36604,"lng":-70.682758},"radius":100.0},"id":196,"name":"Huechuraba"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.366548,"lng":-70.735805},"radius":100.0},"id":197,"name":"Jose Francisco"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.384416,"lng":-70.76214},"radius":100.0},"id":198,"name":"Pudahuel"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.393241,"lng":-70.55752},"radius":100.0},"id":199,"name":"Kennedy"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.402963,"lng":-70.65755},"radius":100.0},"id":200,"name":"Einstein"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.09149,"lng":-70.567622},"radius":100.0},"id":201,"name":"Apoquindo"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.418295,"lng":-70.601736},"radius":100.0},"id":202,"name":"Providencia 2700"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-32.826301805628326,"lng":-70.59809056851833},"sw":{"lat":-32.82738367492296,"lng":-70.60042945477932}},"id":162,"name":"LJ"},{"alert":false,"company_id":64,"geofence_type_id":6,"geom":{"ne":{"lat":-37.501268926001686,"lng":-72.32578332138385},"sw":{"lat":-37.502622260247385,"lng":-72.32788617325153}},"id":271,"name":"Base"},{"alert":true,"company_id":61,"geofence_type_id":1,"geom":{"center":{"lat":-33.21619595361679,"lng":-70.76693007638714},"radius":42.343945804970964},"id":272,"name":"Copec - Lampa"},{"alert":false,"company_id":64,"geofence_type_id":3,"geom":{"ne":{"lat":-37.5311734329323,"lng":-72.32452475862753},"sw":{"lat":-37.53187110232522,"lng":-72.32542598085654}},"id":273,"name":"Duqueco"},{"alert":true,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.10726582437688,"lng":-70.45295949820178},"radius":66.97345188335058},"id":102,"name":"Caletones"},{"alert":true,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.171633346042725,"lng":-70.73099924596914},"radius":16.617556095819463},"id":255,"name":"MEMBRILLAR"},{"alert":true,"company_id":8,"geofence_type_id":1,"geom":{"center":{"lat":-33.307701384679206,"lng":-71.0975909418745},"radius":8777.323517445873},"id":258,"name":"Prueba Geo"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.50631,"lng":-70.638125},"radius":100.0},"id":223,"name":"San Joaquin"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-38.710814,"lng":-72.558625},"radius":100.0},"id":243,"name":"Temuco"},{"alert":true,"company_id":39,"geofence_type_id":6,"geom":{"center":{"lat":-33.422450273738214,"lng":-70.6087868812765},"radius":100},"id":203,"name":"Nueva providencia"},{"alert":true,"company_id":41,"geofence_type_id":8,"geom":{"center":{"lat":-29.908406835673926,"lng":-71.26123035833302},"radius":1341.4217597591921},"id":261,"name":"Serena"},{"alert":true,"company_id":24,"geofence_type_id":8,"geom":{"center":{"lat":-23.77243893503184,"lng":-70.31503638127816},"radius":1117.6150426755332},"id":266,"name":"LA NEGRA"},{"alert":false,"company_id":64,"geofence_type_id":8,"geom":{"ne":{"lat":-37.4626922795316,"lng":-72.32501373849738},"sw":{"lat":-37.46357793921477,"lng":-72.326387029513}},"id":274,"name":"vulcanizaciòn"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.424548,"lng":-70.613608},"radius":100.0},"id":204,"name":"Providencia 1880"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.513739,"lng":-70.755742},"radius":100.0},"id":224,"name":"Alberto Llona"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-39.282712,"lng":-72.230122},"radius":100.0},"id":244,"name":"Villarrica"},{"alert":false,"company_id":34,"geofence_type_id":8,"geom":{"center":{"lat":-34.15102398036993,"lng":-70.54969281754722},"radius":44.29784295929153},"id":58,"name":"La Paula (J) "},{"alert":true,"company_id":24,"geofence_type_id":8,"geom":{"center":{"lat":-25.165798151311513,"lng":-69.86939470735655},"radius":3051.0466985951375},"id":267,"name":"OFICINA ALEMANIA"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.425909,"lng":-70.643142},"radius":100.0},"id":205,"name":"Tabare"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.526969,"lng":-70.656132},"radius":100.0},"id":225,"name":"La cisterna"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-40.582387,"lng":-73.107443},"radius":100.0},"id":245,"name":"Osorno"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"ne":{"lat":-33.0458077575451,"lng":-71.34620900988511},"sw":{"lat":-33.049297082777734,"lng":-71.35125156283311}},"id":264,"name":"KE"},{"alert":true,"company_id":24,"geofence_type_id":2,"geom":{"center":{"lat":-26.318381167674694,"lng":-70.62354165101294},"radius":425.20856613615587},"id":268,"name":"CHAÑARAL COSTA"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.429858,"lng":-70.62305},"radius":100.0},"id":206,"name":"Tajamar"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-41.457036,"lng":-72.961698},"radius":100.0},"id":246,"name":"Puerto Montt"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.536119,"lng":-70.738019},"radius":100.0},"id":226,"name":"Cerro sombrero"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.433561,"lng":-70.654486},"radius":100.0},"id":207,"name":"Morande"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.54038,"lng":-70.573941},"radius":100.0},"id":227,"name":"La florida"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-41.87152,"lng":-73.811441},"radius":100.0},"id":247,"name":"Ancud"},{"alert":true,"company_id":24,"geofence_type_id":2,"geom":{"center":{"lat":-26.318381167674694,"lng":-70.62354165101294},"radius":425.20856613615587},"id":270,"name":"CHAÑARAL COSTA"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.442978,"lng":-70.649774},"radius":100.0},"id":208,"name":"Ohiggins"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.55896,"lng":-70.678677},"radius":100.0},"id":228,"name":"El bosque "},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-42.474012,"lng":-73.770758},"radius":100.0},"id":248,"name":"Castro "},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.446755,"lng":-70.678292},"radius":100.0},"id":209,"name":"Chacabuco"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.590514,"lng":-70.703187},"radius":100.0},"id":229,"name":"San bernando"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.450002,"lng":-70.629398},"radius":100.0},"id":210,"name":"Bustamante"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.595966,"lng":-71.614201},"radius":100.0},"id":230,"name":"San antonio"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.451953,"lng":-70.555751},"radius":100.0},"id":211,"name":"La reina"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.731072,"lng":-70.736803},"radius":100.0},"id":231,"name":"Buin"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.453693,"lng":-70.647587},"radius":100.0},"id":212,"name":"Serrano"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-34.174459,"lng":-70.743922},"radius":100.0},"id":232,"name":"Rancagua "},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.454642,"lng":-70.68073},"radius":100.0},"id":213,"name":"San borja"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-34.592263,"lng":-70.98927},"radius":100.0},"id":233,"name":"San fernando"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.454759,"lng":-70.685756},"radius":100.0},"id":214,"name":"Jotabeche 137"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-34.987046,"lng":-71.234205},"radius":100.0},"id":234,"name":"Curico"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.454837,"lng":-70.677979},"radius":100.0},"id":215,"name":"Exposición"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-35.331286,"lng":-72.408384},"radius":100.0},"id":235,"name":"Constitución"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.455655,"lng":-70.672771},"radius":100.0},"id":216,"name":"Toesca"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-35.431841,"lng":-71.637859},"radius":100.0},"id":236,"name":"Talca"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.456967,"lng":-70.637474},"radius":100.0},"id":217,"name":"Matta"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-35.845047,"lng":-71.603391},"radius":100.0},"id":237,"name":"Linares"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.457887,"lng":-70.68545},"radius":100.0},"id":218,"name":"Jotabeche 573"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-35.963789,"lng":-72.322117},"radius":100.0},"id":238,"name":"Cauquenes"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.458593,"lng":-70.649816},"radius":100.0},"id":219,"name":"Aconcagua"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-36.141007,"lng":-71.827847},"radius":100.0},"id":239,"name":"Parral "},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.461618,"lng":-70.573121},"radius":100.0},"id":220,"name":"Peñaloñen "},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-36.58408,"lng":-72.102574},"radius":100.0},"id":240,"name":"Chillan "},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.471332,"lng":-70.610132},"radius":100.0},"id":221,"name":"Ñuñoa"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-36.781373,"lng":-73.078735},"radius":100.0},"id":241,"name":"Concepción "},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-27.37043,"lng":-70.333833},"radius":100.0},"id":181,"name":"Copiapo"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.479968,"lng":-70.692161},"radius":100.0},"id":222,"name":"Cerillos"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-37.448412,"lng":-72.335996},"radius":100.0},"id":242,"name":"Los angeles"},{"alert":true,"company_id":29,"geofence_type_id":8,"geom":{"center":{"lat":-33.125131428778126,"lng":-71.56515383444543},"radius":107.31923300445878},"id":249,"name":"CR"},{"alert":true,"company_id":9,"geofence_type_id":6,"geom":{"center":{"lat":-33.50647667797365,"lng":-70.65289665006344},"radius":47.43936179399538},"id":70,"name":"Agencia Carmen Mena"}]';
    $geofences = json_decode($geofences);
    $devices = get_data();
    $found = [];
    foreach ($geofences as $geofence) {
        if (strpos(strtolower($geofence->name), strtolower($filter)) !== false) {
            foreach ($devices as $device) {
                if ($device->geofence_id == $geofence->id) {
                    array_push($found, $geofence->name . " - " . $device->name . " https://www.google.com/maps/?q=" . $device->lat . "," . $device->lng);
                }
            }
        }
    }
    return $found;
}

function get_status()
{
    $devices = get_data();
    $countStop = 0;
    $countMoving = 0;
    $text = '';
    $text .= '*_Estado de la flota_* \\n ';
    foreach ($devices as $device) {
        if ($device->stop_time > 10) {
            $countStop += 1;
        }
        if ($device->stop_time <= 10) {
            $countMoving += 1;
        }
    }
    $text .= '*' . $countMoving . '* vehículos en movimiento \\n ';
    $text .= '*' . $countStop . '* vehículos detenidos \\n \\n ';
    return $text;
}
function get_excesos()
{
    $devices = get_data();
    $text = '*_Excesos sobre 120 km/h_* \\n ';
    foreach ($devices as $device) {
        if ($device->velocity > 120) {
            $text .= '*' . $device->name . '* viajando a '. $device->velocity.' km/h \\n ';
        }
    }

    return $text;
}
function get_excesos_sobre($number)
{
    $devices = get_data();
    $text = '*_Excesos sobre '.$number.' km/h_* \\n ';
    foreach ($devices as $device) {
        if ($device->velocity > intval($number)) {
            $text .= '*' . $device->name . '* viajando a '. $device->velocity.' km/h \\n ';
        }
    }

    return $text;
}


function get_status_flota($filter)
{
    $cids = [];
    $companies = '[{"geotab_group_id":null,"id":8,"name":"Pulverizadores Parada SA"},{"geotab_group_id":null,"id":11,"name":"GESTSOL"},{"geotab_group_id":null,"id":12,"name":"Minera Escondida"},{"geotab_group_id":null,"id":1,"name":"ADMIN"},{"geotab_group_id":null,"id":13,"name":"Pruebas Pullman"},{"geotab_group_id":null,"id":9,"name":"Pullman Cargo"},{"geotab_group_id":null,"id":14,"name":"Mutual de seguridad"},{"geotab_group_id":null,"id":15,"name":"Romani bus"},{"geotab_group_id":null,"id":16,"name":"Pullman bus"},{"geotab_group_id":null,"id":17,"name":"Expreso Norte"},{"geotab_group_id":null,"id":18,"name":"Julio César S.A."},{"geotab_group_id":null,"id":23,"name":"Minera Escondida Limitada"},{"geotab_group_id":null,"id":24,"name":"Tandem"},{"geotab_group_id":null,"id":26,"name":"Sinach"},{"geotab_group_id":null,"id":27,"name":"Francisco Silva"},{"geotab_group_id":"10","id":28,"name":"Tandem / Pullman Cargo"},{"geotab_group_id":null,"id":29,"name":"Pullman Costa Central"},{"geotab_group_id":null,"id":30,"name":"Sinach"},{"geotab_group_id":null,"id":31,"name":"MEL DEMO"},{"geotab_group_id":null,"id":33,"name":"Viña Bus"},{"geotab_group_id":null,"id":34,"name":"Teniente"},{"geotab_group_id":null,"id":35,"name":"Transportes De la Fuente"},{"geotab_group_id":null,"id":36,"name":"Pullman JB Los Angeles"},{"geotab_group_id":null,"id":37,"name":"Lomas Bayas"},{"geotab_group_id":null,"id":38,"name":"Molynor"},{"geotab_group_id":null,"id":42,"name":"Las Condes"},{"geotab_group_id":null,"id":43,"name":"Buses Ahumada"},{"geotab_group_id":null,"id":45,"name":"Admin Las Condes"},{"geotab_group_id":null,"id":46,"name":"Demo Gestsol"},{"geotab_group_id":null,"id":47,"name":"Pullman Norte-Sur"},{"geotab_group_id":null,"id":48,"name":"COSTA PULLMAN BUS"},{"geotab_group_id":null,"id":49,"name":"Nilahue"},{"geotab_group_id":null,"id":50,"name":"TandemRadio"},{"geotab_group_id":null,"id":51,"name":"Tandem Guanaco"},{"geotab_group_id":null,"id":52,"name":"Dataprom"},{"geotab_group_id":null,"id":53,"name":"Teknokont"},{"geotab_group_id":null,"id":54,"name":"LKW"},{"geotab_group_id":null,"id":44,"name":"Urbanos Pullman Cargo"},{"geotab_group_id":null,"id":41,"name":"Interprovincial Minero"},{"geotab_group_id":null,"id":39,"name":"CMPC"},{"geotab_group_id":null,"id":32,"name":"Troncales Pullman Cargo"},{"geotab_group_id":null,"id":55,"name":"Ripley"},{"geotab_group_id":null,"id":56,"name":"Buses Nilahue"},{"geotab_group_id":null,"id":57,"name":"TestAPI"},{"geotab_group_id":null,"id":2,"name":"Demo"},{"geotab_group_id":null,"id":58,"name":"VIN"},{"geotab_group_id":null,"id":59,"name":"Levantec"},{"geotab_group_id":null,"id":61,"name":"Transportes 5"},{"geotab_group_id":null,"id":62,"name":"DEMRE"},{"geotab_group_id":null,"id":63,"name":"Demo-Comercial"},{"geotab_group_id":null,"id":64,"name":"Krusesa"},{"geotab_group_id":null,"id":65,"name":"Demo-Paraguay"},{"geotab_group_id":null,"id":66,"name":"Wit_Paraguay"},{"geotab_group_id":null,"id":67,"name":"Zaldivar"},{"geotab_group_id":null,"id":68,"name":"Wit_Cloudb2b"}]';
    $companies = json_decode($companies);
    $text = '';
    foreach ($companies as $c) {
        if (strpos(strtolower($c->name), strtolower($filter)) !== false) {
            $data = [];
            $data['name'] = $c->name;
            $data['id'] = $c->id;
            array_push($cids, $data);
        }
    }
    if (count($cids) == 0 ){
        $devices = get_data();
    }
    else {
        foreach ($cids as $c) {
            $devices = get_data_flota($c['id']);
            $text .= '*_' . $c['name'] . '_* \\n ';
            $countStop = 0;
            $countMoving = 0;
            foreach ($devices as $device) {
                if ($device->stop_time > 10) {
                    $countStop += 1;
                }
                if ($device->stop_time <= 10) {
                    $countMoving += 1;
                }
            }
            $text .= '*' . $countMoving . '* vehículos en movimiento \\n ';
            $text .= '*' . $countStop . '* vehículos detenidos \\n \\n ';

        }
    }
    return $text;
}
